# 对于大多数项目来说，这个工作流文件不需要更改；你只需将其提交到你的代码库中。
#
# 你可以修改这个文件来覆盖分析的语言集合，或者提供自定义的查询或构建逻辑。
#
# ******** 注意 ********
# 我们已经尝试检测你的代码库中的语言。请检查下面定义的 `language` 矩阵，确认你有正确的支持的 CodeQL 语言集合。
#
name: "CodeQL"

on:
  push:
    branches: [ "master" ]
  pull_request:
    # 下面的分支必须是上面的分支的子集
    branches: [ "master" ]
  schedule:
    - cron: '33 14 * * 4'

jobs:
  analyze:
    name: 分析
    # Runner 的大小会影响 CodeQL 分析时间。了解更多信息，请参见：
    #   - https://gh.io/recommended-hardware-resources-for-running-codeql
    #   - https://gh.io/supported-runners-and-hardware-resources
    #   - https://gh.io/using-larger-runners
    # 考虑使用更大的 Runner 来提高分析时间。
    runs-on: ${{ (matrix.language == 'swift' && 'macos-latest') || 'ubuntu-latest' }}
    timeout-minutes: ${{ (matrix.language == 'swift' && 120) || 360 }}
    permissions:
      actions: read
      contents: read
      security-events: write

    strategy:
      fail-fast: false
      matrix:
        language: [ 'java' ]
        # CodeQL 支持 [ 'cpp', 'csharp', 'go', 'java', 'javascript', 'python', 'ruby', 'swift' ]
        # 仅使用 'java' 来分析使用 Java、Kotlin 或两者编写的代码
        # 仅使用 'javascript' 来分析使用 JavaScript、TypeScript 或两者编写的代码
        # 在 https://aka.ms/codeql-docs/language-support 了解更多关于 CodeQL 语言支持的信息

    steps:
    - name: 检出代码库
      uses: actions/checkout@v3

    # 初始化 CodeQL 工具进行扫描。
    - name: 初始化 CodeQL
      uses: github/codeql-action/init@v2
      with:
        languages: ${{ matrix.language }}
        # 如果你想指定自定义查询，可以在这里或配置文件中进行。
        # 默认情况下，这里列出的查询将覆盖配置文件中指定的查询。
        # 在这里的列表前面加上 "+" 可以同时使用这里列出的查询和配置文件中的查询。

        # 有关 CodeQL 查询包的详细信息，请参阅：https://docs.github.com/en/code-security/code-scanning/automatically-scanning-your-code-for-vulnerabilities-and-errors/configuring-code-scanning#using-queries-in-ql-packs
        # queries: security-extended,security-and-quality

    # Autobuild 尝试构建任何编译语言（C/C++、C#、Go、Java 或 Swift）。
    # 如果这一步失败，你应该删除它并手动运行构建（参见下面的示例）。
    - name: 自动构建
      uses: github/codeql-action/autobuild@v2

    - name: ls 
      run: |
        pwd && ls -la && tree

    # ℹ️ 使用操作系统 shell 运行的命令行程序。
    # 📚 参见 https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstepsrun

    #   如果上面的 Autobuild 失败，请删除它，并取消下面三行的注释。
    #   修改它们（或添加更多）以构建你的代码，如果你的项目，请参考下面的示例进行指导。

    # - run: |
    #     echo "运行，使用脚本构建应用程序"
    #     ./location_of_script_within_repo/buildscript.sh

    - name: 执行 CodeQL 分析
      uses: github/codeql-action/analyze@v2
      with:
        category: "/language:${{matrix.language}}"
